!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("maptalks")):"function"==typeof define&&define.amd?define(["exports","maptalks"],t):t(e.maptalks=e.maptalks||{},e.maptalks)}(this,function(e,t){"use strict";function r(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):function(e,t){for(var r=Object.getOwnPropertyNames(t),o=0;o<r.length;o++){var i=r[o],n=Object.getOwnPropertyDescriptor(t,i);n&&n.configurable&&void 0===e[i]&&Object.defineProperty(e,i,n)}}(e,t))}var o=t.Util.extend,i={uppercase:!1,detectRetina:!1},n={transparent:!0,format:"png32",f:"image"},a=function(e){function t(t,r){var i;i=e.call(this,t)||this;var a=o({},n);for(var p in r)p in i.options||(a[p]=r[p]);return i.arcParams=a,i.setOptions(r),i.setZIndex(r.zIndex),i.onConfig(),i}r(t,e);var a=t.prototype;return a.getTileUrl=function(t,r,o){var n=this.getSpatialReference().getResolution(o),a=this._getTileConfig().getTilePrjExtent(t,r,n),p=a.getMax(),s=a.getMin(),c=[s.x,s.y,p.x,p.y].join(","),l=(this.getSpatialReference().getProjection()||this.getMap().getProjection()).code.split(":").pop();this.arcParams.bboxSR=l,this.arcParams.imageSR=l;var f=this.getTileSize();this.arcParams.size=f.width+","+f.height;var u=this.getMap().getDevicePixelRatio(),g=i.detectRetina?u:1;this.arcParams.dpi=90*g;var m=e.prototype.getTileUrl.call(this,t,r,o);return m+function(e,t,r){var o=[];for(var i in e)o.push(encodeURIComponent(r?i.toUpperCase():i)+"="+encodeURIComponent(e[i]));return(t&&-1!==t.indexOf("?")?"&":"?")+o.join("&")}(this.arcParams,m,this.options.uppercase)+(this.options.uppercase?"&BBOX=":"&bbox=")+c},a.onConfig=function(){var e=this.options.urlTemplate;this.options.urlTemplate=e.replace(/MapServer\/?$/,"MapServer/export").replace(/ImageServer\/?$/,"ImageServer/exportImage")},a.toJSON=function(){return{type:"ArcGISTileLayer",id:this.getId(),options:this.config()}},t.fromJSON=function(e){return e&&"ArcGISTileLayer"===e.type?new t(e.id,e.options):null},t}(t.TileLayer);a.registerJSONType("ArcGISTileLayer"),a.mergeOptions(i),e.ArcGISTileLayer=a,Object.defineProperty(e,"__esModule",{value:!0}),"undefined"!=typeof console&&console.log("maptalks.ArcGISTileLayer v0.1.0, requires maptalks@^0.39.0.")});