!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("maptalks")):"function"==typeof define&&define.amd?define(["exports","maptalks"],t):t(e.maptalks=e.maptalks||{},e.maptalks)}(this,function(e,t){"use strict";function r(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):function(e,t){for(var r=Object.getOwnPropertyNames(t),i=0;i<r.length;i++){var o=r[i],n=Object.getOwnPropertyDescriptor(t,o);n&&n.configurable&&void 0===e[o]&&Object.defineProperty(e,o,n)}}(e,t))}var i=t.Util.extend,o={uppercase:!1,detectRetina:!1},n={transparent:!0,format:"png32",f:"image"},a=function(e){function t(t,r){var o;o=e.call(this,t)||this;var a=i({},n);for(var p in r)p in o.options||(a[p]=r[p]);var s=r.urlTemplate;return r.urlTemplate=s.replace(/MapServer\/?$/,"MapServer/export").replace(/ImageServer\/?$/,"ImageServer/exportImage"),o.arcParams=a,o.setOptions(r),o.setZIndex(r.zIndex),o}r(t,e);var a=t.prototype;return a.getTileUrl=function(t,r,i){var n=this.getSpatialReference().getResolution(i),a=this._getTileConfig().getTilePrjExtent(t,r,n),p=a.getMax(),s=a.getMin(),c=[s.x,s.y,p.x,p.y].join(","),l=(this.getSpatialReference().getProjection()||this.getMap().getProjection()).code.split(":").pop();this.arcParams.bboxSR=l,this.arcParams.imageSR=l;var u=this.getTileSize();this.arcParams.size=u.width+","+u.height;var f=this.getMap().getDevicePixelRatio(),g=o.detectRetina?f:1;this.arcParams.dpi=90*g;var m=e.prototype.getTileUrl.call(this,t,r,i);return m+function(e,t,r){var i=[];for(var o in e)i.push(encodeURIComponent(r?o.toUpperCase():o)+"="+encodeURIComponent(e[o]));return(t&&-1!==t.indexOf("?")?"&":"?")+i.join("&")}(this.arcParams,m,this.options.uppercase)+(this.options.uppercase?"&BBOX=":"&bbox=")+c},a.toJSON=function(){return{type:"ArcGISTileLayer",id:this.getId(),options:this.config()}},t.fromJSON=function(e){return e&&"ArcGISTileLayer"===e.type?new t(e.id,e.options):null},t}(t.TileLayer);a.registerJSONType("ArcGISTileLayer"),a.mergeOptions(o),e.ArcGISTileLayer=a,Object.defineProperty(e,"__esModule",{value:!0}),"undefined"!=typeof console&&console.log("maptalks.ArcGISTileLayer v0.1.0, requires maptalks@^0.39.0.")});